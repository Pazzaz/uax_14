//! An implementation of [UAX #14], also called the `Unicode Line Breaking
//! Algorithm`.
//!
//! [UAX #14]: https://www.unicode.org/reports/tr14/
use std::char;
use std::iter::Peekable;
use std::str::Chars;

/// Converts a `char` to its corresponding [Line Breaking Class].
///
/// *See [`Class`].*
///
/// [Line Breaking Class]: https://www.unicode.org/reports/tr14/#Table1
pub fn convert_to_break_class(n: char) -> Class {
    // Automatically generated by `../build.rs`
    include!(concat!(env!("OUT_DIR"), "/convert_to_break_class"))
}

/// A [Line Breaking Class].
///
/// Interacting directly with Line Breaking Classes is usually not neccessary
/// unless you want to implement something similar to [`LineBreaks`].
///
/// For converting `char` to `Class`, see [`convert_to_break_class`].
///
/// Some classes are missing because of [LB1]. These are [SG] (invalid in any
/// input), [SA] (treated as [CM] or [AL] depending on its General Category),
/// [CJ] (treated as [NS]), [XX], [SG] and [AI] (all treated as [AL]).
///
/// [SG]: https://www.unicode.org/reports/tr14/#SG
/// [SA]: https://www.unicode.org/reports/tr14/#SA
/// [CM]: https://www.unicode.org/reports/tr14/#CM
/// [AL]: https://www.unicode.org/reports/tr14/#AL
/// [CJ]: https://www.unicode.org/reports/tr14/#CJ
/// [NS]: https://www.unicode.org/reports/tr14/#NS
/// [XX]: https://www.unicode.org/reports/tr14/#XX
/// [SG]: https://www.unicode.org/reports/tr14/#SG
/// [AI]: https://www.unicode.org/reports/tr14/#AI
/// [AL]: https://www.unicode.org/reports/tr14/#AL
/// [Line Breaking Class]: https://www.unicode.org/reports/tr14/#Table1
/// [LB1]: https://www.unicode.org/reports/tr14/#LB1
#[derive(Debug, PartialEq, Clone, Copy)]
pub enum Class {
    // Non-tailorable Line Breaking Classes
    BK = 0, // Mandatory Break
    CR = 1, // Carriage Return
    LF = 2, // Line Feed
    CM = 3, // Combining Mark
    NL = 4, // Next Line
    // SG,  // Surrogate - Not used
    WJ = 5,  // Word Joiner
    ZW = 6,  // Zero Width Space
    GL = 7,  // Non-breaking ("Glue")
    SP = 8,  // Space
    ZWJ = 9, // Zero Width Joiner

    // Break Opportunities
    B2 = 10, // Break Opportunity Before and After
    BA = 11, // Break After
    BB = 12, // Break Before
    HY = 13, // Hyphen
    CB = 14, // Contingent Break After

    // Characters Prohibiting Certain Breaks
    CL = 15, // Clone Punctuation
    CP = 16, // Close Parenthesis
    EX = 17, // Exclamation/Interrogation
    IN = 18, // Inseparable
    NS = 19, // Nonstarter
    OP = 20, // Open Punctuation
    QU = 21, // Quatation

    // Numeric Context
    IS = 22, // Infix Numeric Separator
    NU = 23, // Numeric
    PO = 24, // Postfix Numeric
    PR = 25, // Prefix Numeric
    SY = 26, // Symbols Allowing Break After

    // Other Characters
    // AI, // Ambiguous (Alphabetic or Ideographic) - Not used
    AL = 27, // Alphabetic
    // CJ, // Conditional Japanese Starter - Not used
    EB = 28, // Emoji Base
    EM = 29, // Emoji Modifier
    H2 = 30, // Hangul LV Syllable
    H3 = 31, // Hangul LVT Syllable
    HL = 32, // Hebrew Letter
    ID = 33, // Ideographic
    JL = 34, // Hangul L Jamo
    JV = 35, // Hangul V Jamo
    JT = 36, // Hangul T Jamo
    RI = 37, // Regional Indicator
    // SA, // Complex Context Dependent (South East Asian) - Not used
    XX = 38, // Unknown
}

const NUM_OF_CLASSES: usize = 39;
const STATES: [[(usize, bool); NUM_OF_CLASSES]; 48] = [
    [
        (0, true),
        (1, true),
        (2, true),
        (3, true),
        (4, true),
        (5, true),
        (6, true),
        (7, true),
        (8, true),
        (9, true),
        (10, true),
        (11, true),
        (12, true),
        (13, true),
        (14, true),
        (15, true),
        (16, true),
        (17, true),
        (18, true),
        (19, true),
        (20, true),
        (21, true),
        (22, true),
        (23, true),
        (24, true),
        (25, true),
        (26, true),
        (27, true),
        (28, true),
        (29, true),
        (30, true),
        (31, true),
        (32, true),
        (33, true),
        (34, true),
        (35, true),
        (36, true),
        (37, true),
        (38, true),
    ],
    [
        (0, true),
        (1, true),
        (2, false),
        (3, true),
        (4, true),
        (5, true),
        (6, true),
        (7, true),
        (8, true),
        (9, true),
        (10, true),
        (11, true),
        (12, true),
        (13, true),
        (14, true),
        (15, true),
        (16, true),
        (17, true),
        (18, true),
        (19, true),
        (20, true),
        (21, true),
        (22, true),
        (23, true),
        (24, true),
        (25, true),
        (26, true),
        (27, true),
        (28, true),
        (29, true),
        (30, true),
        (31, true),
        (32, true),
        (33, true),
        (34, true),
        (35, true),
        (36, true),
        (37, true),
        (38, true),
    ],
    [
        (0, true),
        (1, true),
        (2, true),
        (3, true),
        (4, true),
        (5, true),
        (6, true),
        (7, true),
        (8, true),
        (9, true),
        (10, true),
        (11, true),
        (12, true),
        (13, true),
        (14, true),
        (15, true),
        (16, true),
        (17, true),
        (18, true),
        (19, true),
        (20, true),
        (21, true),
        (22, true),
        (23, true),
        (24, true),
        (25, true),
        (26, true),
        (27, true),
        (28, true),
        (29, true),
        (30, true),
        (31, true),
        (32, true),
        (33, true),
        (34, true),
        (35, true),
        (36, true),
        (37, true),
        (38, true),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (3, false),
        (4, false),
        (5, false),
        (6, false),
        (7, false),
        (8, false),
        (3, false),
        (10, true),
        (11, false),
        (12, true),
        (13, false),
        (14, true),
        (15, false),
        (16, false),
        (17, false),
        (18, false),
        (19, false),
        (20, false),
        (21, false),
        (22, false),
        (23, false),
        (24, false),
        (25, false),
        (26, false),
        (27, false),
        (28, true),
        (29, true),
        (30, true),
        (31, true),
        (32, false),
        (33, true),
        (34, true),
        (35, true),
        (36, true),
        (37, true),
        (38, true),
    ],
    [
        (0, true),
        (1, true),
        (2, true),
        (3, true),
        (4, true),
        (5, true),
        (6, true),
        (7, true),
        (8, true),
        (9, true),
        (10, true),
        (11, true),
        (12, true),
        (13, true),
        (14, true),
        (15, true),
        (16, true),
        (17, true),
        (18, true),
        (19, true),
        (20, true),
        (21, true),
        (22, true),
        (23, true),
        (24, true),
        (25, true),
        (26, true),
        (27, true),
        (28, true),
        (29, true),
        (30, true),
        (31, true),
        (32, true),
        (33, true),
        (34, true),
        (35, true),
        (36, true),
        (37, true),
        (38, true),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (5, false),
        (4, false),
        (5, false),
        (6, false),
        (7, false),
        (8, false),
        (5, false),
        (10, false),
        (11, false),
        (12, false),
        (13, false),
        (14, false),
        (15, false),
        (16, false),
        (17, false),
        (18, false),
        (19, false),
        (20, false),
        (21, false),
        (22, false),
        (23, false),
        (24, false),
        (25, false),
        (26, false),
        (27, false),
        (28, false),
        (29, false),
        (30, false),
        (31, false),
        (32, false),
        (33, false),
        (34, false),
        (35, false),
        (36, false),
        (37, false),
        (38, false),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (3, true),
        (4, false),
        (5, true),
        (6, false),
        (7, true),
        (40, false),
        (9, true),
        (10, true),
        (11, true),
        (12, true),
        (13, true),
        (14, true),
        (15, true),
        (16, true),
        (17, true),
        (18, true),
        (19, true),
        (20, true),
        (21, true),
        (22, true),
        (23, true),
        (24, true),
        (25, true),
        (26, true),
        (27, true),
        (28, true),
        (29, true),
        (30, true),
        (31, true),
        (32, true),
        (33, true),
        (34, true),
        (35, true),
        (36, true),
        (37, true),
        (38, true),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (7, false),
        (4, false),
        (5, false),
        (6, false),
        (7, false),
        (8, false),
        (7, false),
        (10, false),
        (11, false),
        (12, false),
        (13, false),
        (14, false),
        (15, false),
        (16, false),
        (17, false),
        (18, false),
        (19, false),
        (20, false),
        (21, false),
        (22, false),
        (23, false),
        (24, false),
        (25, false),
        (26, false),
        (27, false),
        (28, false),
        (29, false),
        (30, false),
        (31, false),
        (32, false),
        (33, false),
        (34, false),
        (35, false),
        (36, false),
        (37, false),
        (38, false),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (3, true),
        (4, false),
        (5, false),
        (6, false),
        (7, true),
        (8, false),
        (9, true),
        (10, true),
        (11, true),
        (12, true),
        (13, true),
        (14, true),
        (15, false),
        (16, false),
        (17, false),
        (18, true),
        (19, true),
        (20, true),
        (21, true),
        (22, false),
        (23, true),
        (24, true),
        (25, true),
        (26, false),
        (27, true),
        (28, true),
        (29, true),
        (30, true),
        (31, true),
        (32, true),
        (33, true),
        (34, true),
        (35, true),
        (36, true),
        (37, true),
        (38, true),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (3, false),
        (4, false),
        (5, false),
        (6, false),
        (7, false),
        (8, false),
        (9, false),
        (10, false),
        (11, false),
        (12, false),
        (13, false),
        (14, false),
        (15, false),
        (16, false),
        (17, false),
        (18, false),
        (19, false),
        (20, false),
        (21, false),
        (22, false),
        (23, false),
        (24, false),
        (25, false),
        (26, false),
        (27, false),
        (28, false),
        (29, false),
        (30, false),
        (31, false),
        (32, false),
        (33, false),
        (34, false),
        (35, false),
        (36, false),
        (37, false),
        (38, false),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (10, false),
        (4, false),
        (5, false),
        (6, false),
        (7, false),
        (44, false),
        (10, false),
        (10, false),
        (11, false),
        (12, true),
        (13, false),
        (14, true),
        (15, false),
        (16, false),
        (17, false),
        (18, true),
        (19, false),
        (20, true),
        (21, false),
        (22, false),
        (23, true),
        (24, true),
        (25, true),
        (26, false),
        (27, true),
        (28, true),
        (29, true),
        (30, true),
        (31, true),
        (32, true),
        (33, true),
        (34, true),
        (35, true),
        (36, true),
        (37, true),
        (38, true),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (11, false),
        (4, false),
        (5, false),
        (6, false),
        (7, true),
        (8, false),
        (11, false),
        (10, true),
        (11, false),
        (12, true),
        (13, false),
        (14, true),
        (15, false),
        (16, false),
        (17, false),
        (18, true),
        (19, false),
        (20, true),
        (21, false),
        (22, false),
        (23, true),
        (24, true),
        (25, true),
        (26, false),
        (27, true),
        (28, true),
        (29, true),
        (30, true),
        (31, true),
        (32, true),
        (33, true),
        (34, true),
        (35, true),
        (36, true),
        (37, true),
        (38, true),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (12, false),
        (4, false),
        (5, false),
        (6, false),
        (7, false),
        (8, false),
        (12, false),
        (10, false),
        (11, false),
        (12, false),
        (13, false),
        (14, true),
        (15, false),
        (16, false),
        (17, false),
        (18, false),
        (19, false),
        (20, false),
        (21, false),
        (22, false),
        (23, false),
        (24, false),
        (25, false),
        (26, false),
        (27, false),
        (28, false),
        (29, false),
        (30, false),
        (31, false),
        (32, false),
        (33, false),
        (34, false),
        (35, false),
        (36, false),
        (37, false),
        (38, false),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (13, false),
        (4, false),
        (5, false),
        (6, false),
        (7, true),
        (8, false),
        (13, false),
        (10, true),
        (11, false),
        (12, true),
        (13, false),
        (14, true),
        (15, false),
        (16, false),
        (17, false),
        (18, true),
        (19, false),
        (20, true),
        (21, false),
        (22, false),
        (23, false),
        (24, true),
        (25, true),
        (26, false),
        (27, true),
        (28, true),
        (29, true),
        (30, true),
        (31, true),
        (32, true),
        (33, true),
        (34, true),
        (35, true),
        (36, true),
        (37, true),
        (38, true),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (14, false),
        (4, false),
        (5, false),
        (6, false),
        (7, false),
        (8, false),
        (14, false),
        (10, true),
        (11, true),
        (12, true),
        (13, true),
        (14, true),
        (15, false),
        (16, false),
        (17, false),
        (18, true),
        (19, true),
        (20, true),
        (21, false),
        (22, false),
        (23, true),
        (24, true),
        (25, true),
        (26, false),
        (27, true),
        (28, true),
        (29, true),
        (30, true),
        (31, true),
        (32, true),
        (33, true),
        (34, true),
        (35, true),
        (36, true),
        (37, true),
        (38, true),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (15, false),
        (4, false),
        (5, false),
        (6, false),
        (7, false),
        (43, false),
        (15, false),
        (10, true),
        (11, false),
        (12, true),
        (13, false),
        (14, true),
        (15, false),
        (16, false),
        (17, false),
        (18, true),
        (19, false),
        (20, true),
        (21, false),
        (22, false),
        (23, true),
        (24, false),
        (25, false),
        (26, false),
        (27, true),
        (28, true),
        (29, true),
        (30, true),
        (31, true),
        (32, true),
        (33, true),
        (34, true),
        (35, true),
        (36, true),
        (37, true),
        (38, true),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (16, false),
        (4, false),
        (5, false),
        (6, false),
        (7, false),
        (43, false),
        (16, false),
        (10, true),
        (11, false),
        (12, true),
        (13, false),
        (14, true),
        (15, false),
        (16, false),
        (17, false),
        (18, true),
        (19, false),
        (20, true),
        (21, false),
        (22, false),
        (23, false),
        (24, false),
        (25, false),
        (26, false),
        (27, false),
        (28, true),
        (29, true),
        (30, true),
        (31, true),
        (32, false),
        (33, true),
        (34, true),
        (35, true),
        (36, true),
        (37, true),
        (38, true),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (17, false),
        (4, false),
        (5, false),
        (6, false),
        (7, false),
        (8, false),
        (17, false),
        (10, true),
        (11, false),
        (12, true),
        (13, false),
        (14, true),
        (15, false),
        (16, false),
        (17, false),
        (18, false),
        (19, false),
        (20, true),
        (21, false),
        (22, false),
        (23, true),
        (24, true),
        (25, true),
        (26, false),
        (27, true),
        (28, true),
        (29, true),
        (30, true),
        (31, true),
        (32, true),
        (33, true),
        (34, true),
        (35, true),
        (36, true),
        (37, true),
        (38, true),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (18, false),
        (4, false),
        (5, false),
        (6, false),
        (7, false),
        (8, false),
        (18, false),
        (10, true),
        (11, false),
        (12, true),
        (13, false),
        (14, true),
        (15, false),
        (16, false),
        (17, false),
        (18, false),
        (19, false),
        (20, true),
        (21, false),
        (22, false),
        (23, true),
        (24, true),
        (25, true),
        (26, false),
        (27, true),
        (28, true),
        (29, true),
        (30, true),
        (31, true),
        (32, true),
        (33, true),
        (34, true),
        (35, true),
        (36, true),
        (37, true),
        (38, true),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (19, false),
        (4, false),
        (5, false),
        (6, false),
        (7, false),
        (8, false),
        (19, false),
        (10, true),
        (11, false),
        (12, true),
        (13, false),
        (14, true),
        (15, false),
        (16, false),
        (17, false),
        (18, true),
        (19, false),
        (20, true),
        (21, false),
        (22, false),
        (23, true),
        (24, true),
        (25, true),
        (26, false),
        (27, true),
        (28, true),
        (29, true),
        (30, true),
        (31, true),
        (32, true),
        (33, true),
        (34, true),
        (35, true),
        (36, true),
        (37, true),
        (38, true),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (20, false),
        (4, false),
        (5, false),
        (6, false),
        (7, false),
        (41, false),
        (20, false),
        (10, false),
        (11, false),
        (12, false),
        (13, false),
        (14, false),
        (15, false),
        (16, false),
        (17, false),
        (18, false),
        (19, false),
        (20, false),
        (21, false),
        (22, false),
        (23, false),
        (24, false),
        (25, false),
        (26, false),
        (27, false),
        (28, false),
        (29, false),
        (30, false),
        (31, false),
        (32, false),
        (33, false),
        (34, false),
        (35, false),
        (36, false),
        (37, false),
        (38, false),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (21, false),
        (4, false),
        (5, false),
        (6, false),
        (7, false),
        (42, false),
        (21, false),
        (10, false),
        (11, false),
        (12, false),
        (13, false),
        (14, false),
        (15, false),
        (16, false),
        (17, false),
        (18, false),
        (19, false),
        (20, false),
        (21, false),
        (22, false),
        (23, false),
        (24, false),
        (25, false),
        (26, false),
        (27, false),
        (28, false),
        (29, false),
        (30, false),
        (31, false),
        (32, false),
        (33, false),
        (34, false),
        (35, false),
        (36, false),
        (37, false),
        (38, false),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (22, false),
        (4, false),
        (5, false),
        (6, false),
        (7, false),
        (8, false),
        (22, false),
        (10, true),
        (11, false),
        (12, true),
        (13, false),
        (14, true),
        (15, false),
        (16, false),
        (17, false),
        (18, true),
        (19, false),
        (20, true),
        (21, false),
        (22, false),
        (23, false),
        (24, true),
        (25, true),
        (26, false),
        (27, false),
        (28, true),
        (29, true),
        (30, true),
        (31, true),
        (32, false),
        (33, true),
        (34, true),
        (35, true),
        (36, true),
        (37, true),
        (38, true),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (23, false),
        (4, false),
        (5, false),
        (6, false),
        (7, false),
        (8, false),
        (23, false),
        (10, true),
        (11, false),
        (12, true),
        (13, false),
        (14, true),
        (15, false),
        (16, false),
        (17, false),
        (18, false),
        (19, false),
        (20, false),
        (21, false),
        (22, false),
        (23, false),
        (24, false),
        (25, false),
        (26, false),
        (27, false),
        (28, true),
        (29, true),
        (30, true),
        (31, true),
        (32, false),
        (33, true),
        (34, true),
        (35, true),
        (36, true),
        (37, true),
        (38, true),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (24, false),
        (4, false),
        (5, false),
        (6, false),
        (7, false),
        (8, false),
        (24, false),
        (10, true),
        (11, false),
        (12, true),
        (13, false),
        (14, true),
        (15, false),
        (16, false),
        (17, false),
        (18, true),
        (19, false),
        (20, false),
        (21, false),
        (22, false),
        (23, false),
        (24, true),
        (25, true),
        (26, false),
        (27, false),
        (28, true),
        (29, true),
        (30, true),
        (31, true),
        (32, false),
        (33, true),
        (34, true),
        (35, true),
        (36, true),
        (37, true),
        (38, true),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (25, false),
        (4, false),
        (5, false),
        (6, false),
        (7, false),
        (8, false),
        (25, false),
        (10, true),
        (11, false),
        (12, true),
        (13, false),
        (14, true),
        (15, false),
        (16, false),
        (17, false),
        (18, true),
        (19, false),
        (20, false),
        (21, false),
        (22, false),
        (23, false),
        (24, true),
        (25, true),
        (26, false),
        (27, false),
        (28, false),
        (29, false),
        (30, false),
        (31, false),
        (32, false),
        (33, false),
        (34, false),
        (35, false),
        (36, false),
        (37, true),
        (38, true),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (26, false),
        (4, false),
        (5, false),
        (6, false),
        (7, false),
        (8, false),
        (26, false),
        (10, true),
        (11, false),
        (12, true),
        (13, false),
        (14, true),
        (15, false),
        (16, false),
        (17, false),
        (18, true),
        (19, false),
        (20, true),
        (21, false),
        (22, false),
        (23, false),
        (24, true),
        (25, true),
        (26, false),
        (27, true),
        (28, true),
        (29, true),
        (30, true),
        (31, true),
        (32, false),
        (33, true),
        (34, true),
        (35, true),
        (36, true),
        (37, true),
        (38, true),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (27, false),
        (4, false),
        (5, false),
        (6, false),
        (7, false),
        (8, false),
        (27, false),
        (10, true),
        (11, false),
        (12, true),
        (13, false),
        (14, true),
        (15, false),
        (16, false),
        (17, false),
        (18, false),
        (19, false),
        (20, false),
        (21, false),
        (22, false),
        (23, false),
        (24, false),
        (25, false),
        (26, false),
        (27, false),
        (28, true),
        (29, true),
        (30, true),
        (31, true),
        (32, false),
        (33, true),
        (34, true),
        (35, true),
        (36, true),
        (37, true),
        (38, true),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (28, false),
        (4, false),
        (5, false),
        (6, false),
        (7, false),
        (8, false),
        (28, false),
        (10, true),
        (11, false),
        (12, true),
        (13, false),
        (14, true),
        (15, false),
        (16, false),
        (17, false),
        (18, false),
        (19, false),
        (20, true),
        (21, false),
        (22, false),
        (23, true),
        (24, false),
        (25, true),
        (26, false),
        (27, true),
        (28, true),
        (29, false),
        (30, true),
        (31, true),
        (32, true),
        (33, true),
        (34, true),
        (35, true),
        (36, true),
        (37, true),
        (38, true),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (29, false),
        (4, false),
        (5, false),
        (6, false),
        (7, false),
        (8, false),
        (29, false),
        (10, true),
        (11, false),
        (12, true),
        (13, false),
        (14, true),
        (15, false),
        (16, false),
        (17, false),
        (18, false),
        (19, false),
        (20, true),
        (21, false),
        (22, false),
        (23, true),
        (24, false),
        (25, true),
        (26, false),
        (27, true),
        (28, true),
        (29, true),
        (30, true),
        (31, true),
        (32, true),
        (33, true),
        (34, true),
        (35, true),
        (36, true),
        (37, true),
        (38, true),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (30, false),
        (4, false),
        (5, false),
        (6, false),
        (7, false),
        (8, false),
        (30, false),
        (10, true),
        (11, false),
        (12, true),
        (13, false),
        (14, true),
        (15, false),
        (16, false),
        (17, false),
        (18, false),
        (19, false),
        (20, true),
        (21, false),
        (22, false),
        (23, true),
        (24, false),
        (25, true),
        (26, false),
        (27, true),
        (28, true),
        (29, true),
        (30, true),
        (31, true),
        (32, true),
        (33, true),
        (34, true),
        (35, false),
        (36, false),
        (37, true),
        (38, true),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (31, false),
        (4, false),
        (5, false),
        (6, false),
        (7, false),
        (8, false),
        (31, false),
        (10, true),
        (11, false),
        (12, true),
        (13, false),
        (14, true),
        (15, false),
        (16, false),
        (17, false),
        (18, false),
        (19, false),
        (20, true),
        (21, false),
        (22, false),
        (23, true),
        (24, false),
        (25, true),
        (26, false),
        (27, true),
        (28, true),
        (29, true),
        (30, true),
        (31, true),
        (32, true),
        (33, true),
        (34, true),
        (35, true),
        (36, false),
        (37, true),
        (38, true),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (32, false),
        (4, false),
        (5, false),
        (6, false),
        (7, false),
        (8, false),
        (32, false),
        (10, true),
        (46, false),
        (12, true),
        (45, false),
        (14, true),
        (15, false),
        (16, false),
        (17, false),
        (18, false),
        (19, false),
        (20, false),
        (21, false),
        (22, false),
        (23, false),
        (24, false),
        (25, false),
        (26, false),
        (27, false),
        (28, true),
        (29, true),
        (30, true),
        (31, true),
        (32, false),
        (33, true),
        (34, true),
        (35, true),
        (36, true),
        (37, true),
        (38, true),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (33, false),
        (4, false),
        (5, false),
        (6, false),
        (7, false),
        (8, false),
        (33, false),
        (10, true),
        (11, false),
        (12, true),
        (13, false),
        (14, true),
        (15, false),
        (16, false),
        (17, false),
        (18, false),
        (19, false),
        (20, true),
        (21, false),
        (22, false),
        (23, true),
        (24, false),
        (25, true),
        (26, false),
        (27, true),
        (28, true),
        (29, true),
        (30, true),
        (31, true),
        (32, true),
        (33, true),
        (34, true),
        (35, true),
        (36, true),
        (37, true),
        (38, true),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (34, false),
        (4, false),
        (5, false),
        (6, false),
        (7, false),
        (8, false),
        (34, false),
        (10, true),
        (11, false),
        (12, true),
        (13, false),
        (14, true),
        (15, false),
        (16, false),
        (17, false),
        (18, false),
        (19, false),
        (20, true),
        (21, false),
        (22, false),
        (23, true),
        (24, false),
        (25, true),
        (26, false),
        (27, true),
        (28, true),
        (29, true),
        (30, false),
        (31, false),
        (32, true),
        (33, true),
        (34, false),
        (35, false),
        (36, true),
        (37, true),
        (38, true),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (35, false),
        (4, false),
        (5, false),
        (6, false),
        (7, false),
        (8, false),
        (35, false),
        (10, true),
        (11, false),
        (12, true),
        (13, false),
        (14, true),
        (15, false),
        (16, false),
        (17, false),
        (18, false),
        (19, false),
        (20, true),
        (21, false),
        (22, false),
        (23, true),
        (24, false),
        (25, true),
        (26, false),
        (27, true),
        (28, true),
        (29, true),
        (30, true),
        (31, true),
        (32, true),
        (33, true),
        (34, true),
        (35, false),
        (36, false),
        (37, true),
        (38, true),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (36, false),
        (4, false),
        (5, false),
        (6, false),
        (7, false),
        (8, false),
        (36, false),
        (10, true),
        (11, false),
        (12, true),
        (13, false),
        (14, true),
        (15, false),
        (16, false),
        (17, false),
        (18, false),
        (19, false),
        (20, true),
        (21, false),
        (22, false),
        (23, true),
        (24, false),
        (25, true),
        (26, false),
        (27, true),
        (28, true),
        (29, true),
        (30, true),
        (31, true),
        (32, true),
        (33, true),
        (34, true),
        (35, true),
        (36, false),
        (37, true),
        (38, true),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (37, false),
        (4, false),
        (5, false),
        (6, false),
        (7, false),
        (8, false),
        (37, false),
        (10, true),
        (11, false),
        (12, true),
        (13, false),
        (14, true),
        (15, false),
        (16, false),
        (17, false),
        (18, true),
        (19, false),
        (20, true),
        (21, false),
        (22, false),
        (23, true),
        (24, true),
        (25, true),
        (26, false),
        (27, true),
        (28, true),
        (29, true),
        (30, true),
        (31, true),
        (32, true),
        (33, true),
        (34, true),
        (35, true),
        (36, true),
        (47, false),
        (38, true),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (38, false),
        (4, false),
        (5, false),
        (6, false),
        (7, false),
        (8, false),
        (38, false),
        (10, true),
        (11, false),
        (12, true),
        (13, false),
        (14, true),
        (15, false),
        (16, false),
        (17, false),
        (18, true),
        (19, false),
        (20, true),
        (21, false),
        (22, false),
        (23, true),
        (24, true),
        (25, true),
        (26, false),
        (27, true),
        (28, true),
        (29, true),
        (30, true),
        (31, true),
        (32, true),
        (33, true),
        (34, true),
        (35, true),
        (36, true),
        (37, true),
        (38, true),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (3, false),
        (4, false),
        (5, false),
        (6, false),
        (7, false),
        (8, false),
        (9, false),
        (10, false),
        (11, false),
        (12, false),
        (13, false),
        (14, false),
        (15, false),
        (16, false),
        (17, false),
        (18, false),
        (19, false),
        (20, false),
        (21, false),
        (22, false),
        (23, false),
        (24, false),
        (25, false),
        (26, false),
        (27, false),
        (28, false),
        (29, false),
        (30, false),
        (31, false),
        (32, false),
        (33, false),
        (34, false),
        (35, false),
        (36, false),
        (37, false),
        (38, false),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (3, true),
        (4, false),
        (5, true),
        (6, false),
        (7, true),
        (8, false),
        (9, true),
        (10, true),
        (11, true),
        (12, true),
        (13, true),
        (14, true),
        (15, true),
        (16, true),
        (17, true),
        (18, true),
        (19, true),
        (20, true),
        (21, true),
        (22, true),
        (23, true),
        (24, true),
        (25, true),
        (26, true),
        (27, true),
        (28, true),
        (29, true),
        (30, true),
        (31, true),
        (32, true),
        (33, true),
        (34, true),
        (35, true),
        (36, true),
        (37, true),
        (38, true),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (3, false),
        (4, false),
        (5, false),
        (6, false),
        (7, false),
        (8, false),
        (9, false),
        (10, false),
        (11, false),
        (12, false),
        (13, false),
        (14, false),
        (15, false),
        (16, false),
        (17, false),
        (18, false),
        (19, false),
        (20, false),
        (21, false),
        (22, false),
        (23, false),
        (24, false),
        (25, false),
        (26, false),
        (27, false),
        (28, false),
        (29, false),
        (30, false),
        (31, false),
        (32, false),
        (33, false),
        (34, false),
        (35, false),
        (36, false),
        (37, false),
        (38, false),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (3, true),
        (4, false),
        (5, false),
        (6, false),
        (7, true),
        (8, false),
        (9, true),
        (10, true),
        (11, true),
        (12, true),
        (13, true),
        (14, true),
        (15, false),
        (16, false),
        (17, false),
        (18, true),
        (19, true),
        (20, false),
        (21, true),
        (22, false),
        (23, true),
        (24, true),
        (25, true),
        (26, false),
        (27, true),
        (28, true),
        (29, true),
        (30, true),
        (31, true),
        (32, true),
        (33, true),
        (34, true),
        (35, true),
        (36, true),
        (37, true),
        (38, true),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (3, true),
        (4, false),
        (5, false),
        (6, false),
        (7, true),
        (8, false),
        (9, true),
        (10, true),
        (11, true),
        (12, true),
        (13, true),
        (14, true),
        (15, false),
        (16, false),
        (17, false),
        (18, true),
        (19, false),
        (20, true),
        (21, true),
        (22, false),
        (23, true),
        (24, true),
        (25, true),
        (26, false),
        (27, true),
        (28, true),
        (29, true),
        (30, true),
        (31, true),
        (32, true),
        (33, true),
        (34, true),
        (35, true),
        (36, true),
        (37, true),
        (38, true),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (3, true),
        (4, false),
        (5, false),
        (6, false),
        (7, true),
        (8, false),
        (9, true),
        (10, false),
        (11, true),
        (12, true),
        (13, true),
        (14, true),
        (15, false),
        (16, false),
        (17, false),
        (18, true),
        (19, true),
        (20, true),
        (21, true),
        (22, false),
        (23, true),
        (24, true),
        (25, true),
        (26, false),
        (27, true),
        (28, true),
        (29, true),
        (30, true),
        (31, true),
        (32, true),
        (33, true),
        (34, true),
        (35, true),
        (36, true),
        (37, true),
        (38, true),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (13, false),
        (4, false),
        (5, false),
        (6, false),
        (7, false),
        (8, false),
        (13, false),
        (10, false),
        (11, false),
        (12, false),
        (13, false),
        (14, false),
        (15, false),
        (16, false),
        (17, false),
        (18, false),
        (19, false),
        (20, false),
        (21, false),
        (22, false),
        (23, false),
        (24, false),
        (25, false),
        (26, false),
        (27, false),
        (28, false),
        (29, false),
        (30, false),
        (31, false),
        (32, false),
        (33, false),
        (34, false),
        (35, false),
        (36, false),
        (37, false),
        (38, false),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (11, false),
        (4, false),
        (5, false),
        (6, false),
        (7, false),
        (8, false),
        (11, false),
        (10, false),
        (11, false),
        (12, false),
        (13, false),
        (14, false),
        (15, false),
        (16, false),
        (17, false),
        (18, false),
        (19, false),
        (20, false),
        (21, false),
        (22, false),
        (23, false),
        (24, false),
        (25, false),
        (26, false),
        (27, false),
        (28, false),
        (29, false),
        (30, false),
        (31, false),
        (32, false),
        (33, false),
        (34, false),
        (35, false),
        (36, false),
        (37, false),
        (38, false),
    ],
    [
        (0, false),
        (1, false),
        (2, false),
        (37, false),
        (4, false),
        (5, false),
        (6, false),
        (7, false),
        (8, false),
        (37, false),
        (10, true),
        (11, false),
        (12, true),
        (13, false),
        (14, true),
        (15, false),
        (16, false),
        (17, false),
        (18, true),
        (19, false),
        (20, true),
        (21, false),
        (22, false),
        (23, true),
        (24, true),
        (25, true),
        (26, false),
        (27, true),
        (28, true),
        (29, true),
        (30, true),
        (31, true),
        (32, true),
        (33, true),
        (34, true),
        (35, true),
        (36, true),
        (37, true),
        (38, true),
    ],
];

/// Used by [`LineBreaks`] to specify whether a break is allowed or not.
///
/// `Mandatory` is where it is expected to be a line break, `Opportunity` is
/// where it is allowed to be a line break and `Prohibited` is where a line
/// break isn't allowed.
#[derive(Debug, PartialEq)]
pub enum Break {
    Mandatory,
    Opportunity,
    Prohibited,
}

/// An `Iterator` that provides information about possible line breaks in a
/// `str`.
///
/// As it checks the position after every `char`, it will not give
/// information about the position before the very first `char`. Luckily that
/// case is trivial as a line break is never allowed there.
///
/// # Examples
///
/// ```
/// use uax_14::{Break, LineBreaks};
///
/// let input = "Which is tree? 木禾夫🤔";
/// let mut split_input = String::new();
/// for (c, br) in LineBreaks::new(&input) {
///     split_input.push(c);
///     if br == Break::Mandatory || br == Break::Opportunity {
///         split_input.push('\n');
///     }
/// }
/// let lines = split_input.split('\n').collect::<Vec<&str>>();
/// assert_eq!(
///     lines,
///     ["Which ", "is ", "tree? ", "木", "禾", "夫", "🤔", ""]
/// );
/// ```
pub struct LineBreaks<'a> {
    iter: Peekable<Chars<'a>>,
    current_state: usize,
}

/// Create a list of all char indices where a line break could be placed.
/// 
/// This gives back indices that correspond to `char`s in the original input. So 0 is before the first `char`, 1 after the first `char` etc.
pub fn linebreaks_char_indices(input: &str) -> Vec<usize> {
    linebreaks(input, true)
}

/// Create a list of all byte indices where a line break could be placed.
/// 
/// This gives back indices that correspond to bytes in the original input. So 0 is before the first byte, 1 after the first byte etc. This is useful when you want to slice a `str` depending on where line breaks are allowed.
pub fn linebreaks_byte_indices(input: &str) -> Vec<usize> {
    linebreaks(input, false)
}

fn linebreaks(input: &str, char_indices: bool) -> Vec<usize> {
    let mut current_state = NUM_OF_CLASSES;
    let mut len = 0;
    let mut full: Vec<usize> = input
        .char_indices()
        .map(|(index, ch)|(index, convert_to_break_class(ch)))
        .enumerate()
        .filter_map(|(char_index, (byte_index, class))| {
            let (new_state, break_allowed) = STATES[current_state][class as usize];
            current_state = new_state;
            len += 1;
            if break_allowed {
                if char_indices {
                    Some(char_index)
                } else {
                    Some(byte_index)
                }
            } else {
                None
            }
        })
        .collect();
    full.push(len);
    full
}

impl<'a> LineBreaks<'a> {
    /// Construct a `LineBreaks` from a `&str`.
    #[inline]
    pub fn new(input: &'a str) -> LineBreaks<'a> {
        let mut i = input.chars().peekable();
        let mut out = LineBreaks {
            iter: i.clone(),
            current_state: NUM_OF_CLASSES,
        };
        out.possible_break(convert_to_break_class(*i.peek().unwrap()));
        out
    }

    fn possible_break(&mut self, c: Class) -> bool {
        let (new_state, br) = STATES[self.current_state][c as usize];
        self.current_state = new_state;
        br
    }
}

/// Provide information as to whether a line break can be appended for each
/// `char` in the input.
impl<'a> Iterator for LineBreaks<'a> {
    type Item = (char, Break);
    #[inline]
    fn next(&mut self) -> Option<Self::Item> {
        let tuple = match (self.iter.next(), self.iter.peek()) {
            (Some(a), Some(&b)) => (
                a,
                if self.possible_break(convert_to_break_class(b)) {
                    Break::Opportunity
                } else {
                    Break::Prohibited
                },
            ),
            (None, Some(_)) => unreachable!(),
            (Some(a), None) => (a, Break::Opportunity),
            (None, None) => {
                return None;
            }
        };
        Some(tuple)
    }
}
